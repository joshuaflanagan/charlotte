<!DOCTYPE html>
<html>
  <head>
    <title>Charlotte</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="buildsScreen">
      <div class="build-display" data-bind="foreach: builds">
        <div class="build" data-bind="css: {
          good: status() == 'SUCCESS',
          bad: status() == 'FAILURE',
          building: building()
          }">
          <h2 data-bind="text: name"></h2>
          <h3 class="description">
            <span data-bind="text: description"></span>
          </h3>
          <!-- <span data-bind="text: lastChecked"></span>-->
          <div data-bind="visible: pollingError()">
            <h3>Error connecting to the CI server</h3>
          </div>
          <div class="build-progress" style="display: none;" data-bind="visible: building()">
            <p>
              Build started:
              <span data-bind="text: buildStarted().formatted()"></span>
            </p>
            <p>
              Expected finish:
              <span data-bind="text: buildEstimate().formatted()"></span>
            </p>
          </div>
        </div>
      </div>

      <footer>
        <section>
          <p><a href="#" data-bind="click: showConfig">configure</a></p>
        </section>
        <section>
          <p>State updated: <span data-bind="text: lastUpdate"></span></p>
        </section>
        <section>
          <p><span data-bind="text: currentTime"></span></p>
        </section>
      </footer>
    </div>

    <div class="configScreen" style="display: none;" data-bind="visible: configVisible">
      <a class="configClose" href="#" data-bind="click: hideConfig">&times; Close</a>
      <form id="configForm">
        <input placeholder="Job Url..." data-bind="value: urlToAdd" />
        <button data-bind="click: addUrl">Add Job Url</button>
        <ul data-bind="foreach: jobUrls">
          <li>
            <span data-bind="text: $data"></span>
            <a href="#" data-bind="click: $root.removeUrl">&times;</a>
          </li>
        </ul>
        <input placeholder="Polling Frequeny" data-bind="value: pollingFrequency" />
        <a href="#" data-bind="click: updateConfig">Start</a>
      </form>
    </div>

  </body>

  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.1/jquery.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.1.0/knockout-min.js"></script>
  <script src="charlotte.js"></script>
  <script>
    var savedUrls = JSON.parse(window.localStorage["jobUrls"] || '[]');
    var pollingFrequency = JSON.parse(window.localStorage["pollingFrequency"] || '30');

    var vm = new CharlotteViewModel(savedUrls, pollingFrequency);
    ko.applyBindings(vm);
  </script>
</html>
