<!DOCTYPE html>
<html>
  <head>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.1.0/knockout-min.js"></script>
    <script src="charlotte.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="buildsScreen" data-bind="visible: !configVisible()">
      <div class="build-display" data-bind="foreach: builds">
        <div class="build" data-bind="css: {
          good: status() == 'SUCCESS',
          bad: status() == 'FAILURE',
          building: building()
          }">
          <h2 data-bind="text: name"></h2>
          <!-- <span data-bind="text: lastChecked"></span>-->
          <div data-bind="visible: pollingError()">
            <h3>Error connecting to the CI server</h3>
          </div>
          <div class="build-progress" data-bind="visible: building()">
            Build started: <span data-bind="text: buildStarted().formatted()"></span>
            <br />
            Expected finish: <span data-bind="text: buildEstimate().formatted()"></span></h3>
          </div>
        </div>
      </div>

      <footer>
      <div><a href="#" data-bind="click: showConfig">configure</a></div>
      <div>State updated: <span data-bind="text: lastUpdate"></span></div>
      <div><span data-bind="text: currentTime"></span></div>
      </footer>
    </div>
    <div id="configScreen" data-bind="visible: configVisible">
      <input data-bind="value: urlToAdd" />
      <button data-bind="click: addUrl">Add Job Url</button>
      <ul data-bind="foreach: jobUrls">
        <li><a href="#" data-bind="click: $root.removeUrl">remove</a>
          <span data-bind="text: $data"></span></li>
      </ul>
      <input data-bind="value: pollingFrequency" />
      <br />
      <a href="#" data-bind="click: hideConfig">Close</a>
    </div>
  </body>

  <script>

    var savedUrls = JSON.parse(window.localStorage["jobUrls"] || '[]');
    var pollingFrequency = JSON.parse(window.localStorage["pollingFrequency"] || '30');

    var vm = new CharlotteViewModel(savedUrls, pollingFrequency);
    ko.applyBindings(vm);
  </script>
</html>
